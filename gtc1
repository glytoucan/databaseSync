#!/usr/bin/groovy
@GrabResolver(name='glycoinfo', root='http://nexus.glycoinfo.org/content/groups/public/')
@GrabResolver(name='glycoinfo-snapshots', root='http://nexus.glycoinfo.org/content/repositories/snapshots/')
//@Grab('org.glytoucan:client:1.2.5-TOCO-SNAPSHOT')
@Grab( group='org.glytoucan',
       module='client',
       version='1.2.5-TOCO-SNAPSHOT',
       changing=true )
@Grab('org.apache.commons:commons-csv:1.2')
import org.glytoucan.client.AntiSpringJavaRest
def cli = new CliBuilder(
   usage: 'gtc -s sequence or -c csvFileName -u contributorId -a apiKey ',
   header: '\nAvailable options (use -h for help):\n',
   footer: '\nInformation provided via above options is used to generate printed string.\n')
import org.apache.commons.cli.Option
cli.with
{
   h(longOpt: 'help', 'usage information', required: false)
   s(longOpt: 'sequence', 'glycan structure sequence', args: 1, required: false)
   c(longOpt: 'csvFileName', 'CSV file name', args: 1, required: false)
   u(longOpt: 'contributorId', 'Contribuor Id', args: 1, required: true)
   a(longOpt: 'apiKey', 'API Key', args: 1, required: true)
   p(longOpt: 'partnerId', 'partnerId', args: 1, required: false)
   o(longOpt: 'outputFormat', 'output format', args: 1, required: false)
}
def opt = cli.parse(args)
if (!opt) return
if (opt.h) cli.usage()
def sequence = opt.s
def csvFileName = opt.c
def contributorId = opt.u
def apiKey = opt.a
def partnerId = opt.p
def oFormat= opt.o
def asjr = new AntiSpringJavaRest()

if (oFormat != 'tsv' && oFormat != 'csv') {
  println "User ID: ${contributorId}"
  println "Api Key: ${apiKey}"
}

if (sequence) {
        if (oFormat != 'tsv' && oFormat != 'csv') {
          println "Registering sequence: ${sequence}"
        }
        String result;
        if (partnerId) {
            if (oFormat != 'tsv' && oFormat != 'csv') {
                println "Partner Id: ${partnerId}"
            }
            result = asjr.register(sequence, partnerId, contributorId, apiKey)
        } else {
            result = asjr.register(sequence, contributorId, apiKey)
        }
        
        if (oFormat == 'tsv') {
          println "${result}\t${sequence}";
        }
        else if (oFormat == 'csv') {
          println "\"${result}\",\"${sequence}\"";
        }
        else {
          println "Accession Number of ${sequence} is ${result}";
        }
}
import org.apache.commons.csv.CSVParser
import org.apache.commons.csv.CSVFormat;
import org.apache.commons.csv.CSVRecord;
import static org.apache.commons.csv.CSVFormat.*
import java.nio.file.Paths
import java.io.IOException;
import java.nio.charset.Charset;
import java.nio.file.Path;
import java.util.List;


if (csvFileName) {

    if (oFormat != 'tsv' && oFormat != 'csv') {
      println "Reading file: ${csvFileName}"
    }
    
    List<CSVRecord> recordList = new ArrayList<CSVRecord>();
    try {

      Paths.get(csvFileName).withReader { reader ->
          CSVParser csv = new CSVParser(reader, DEFAULT.withHeader())

          for (record in csv.iterator()) {
              recordList.push(record)
          }
      }

    } catch (IOException e) {
      e.printStackTrace();
    }

    for (CSVRecord record : recordList) {

            if (record.size() == 2) {

                partnerDBId = record.get(0)
                sequence = record.get(1)
                
                if (oFormat != 'tsv' && oFormat != 'csv') {
                  println "\t" + "contributorId" + "\t" + contributorId
                  println "\t" + "apiKey" + "\t" + apiKey
                  println "\t" + partnerDBId + "\t" + sequence
                  println "Read sequence: " + sequence
                  println "Read partnerDBId: " + partnerDBId
                }
              
                if (sequence) {

                    if (oFormat != 'tsv' && oFormat != 'csv') {
                        println "Registering sequence: " + sequence
                    }  

                    if (partnerId) {
                        if (oFormat != 'tsv' && oFormat != 'csv') {
                            println "Partner Id: ${partnerId}"
                        }

                        result = asjr.register(sequence, partnerId, contributorId, apiKey)
                    }
                    else {
                        result = asjr.register(sequence, contributorId, apiKey)
                    }


                    
                    if (oFormat == 'tsv') {
                      println "${partnerDBId}\t${result}\t${sequence}";
                    }
                    else if (oFormat == 'csv') {
                      println "\"${partnerDBId}\",\"${result}\",\"${sequence}\"";
                    }
                    else {
                      println "Accession Number of ${partnerDBId} (WURCS: ${sequence}) is ${result}";
                    }
                }
            }
            partnerDBId = false;
            sequence = false;
              
        //}
    }
}